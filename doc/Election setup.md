# Pre-election setup
## Electoral register setup and voters’ onboarding

<a><img src="http://www.pebble.vote/images/diagrams/1Pebble_user_creation.png" alt="Pebble User notification" width="600"></a>

When an organizer decides to put together an election, it starts by creating an electoral register. The Election Organizer sends an invitation to each voter to create their public key for Pebble or to submit an existing one. This public key will allow the election organizer to authenticate the voters and prevent users who are not part of the register from participating in the vote.

## Election setup

<a><img src="http://www.pebble.vote/images/diagrams/2Pebble_electoral_roll.png" alt="Pebble User notification" width="600"></a>

Once the electoral register is ready, the Election Organizer prepares the smart contract by uploading the electoral register and setting general parameters such as available choices submitted to the vote as well as the start time and duration of the election.

The electoral register contains a list of digital signature public verification keys that have been previously generated by voters as part of voter registration. To prevent the Election Organizer from inserting fake voters, public keys can be accompanied by additional identifying information. The choice of the type of identifying information is a trade-off between trust in the Election Organizer and preserving voter privacy, and will depend on the broader context and authentication mechanisms in place.

## Credential generation

<a><img src="http://www.pebble.vote/images/diagrams/3Pebble_credential_generation.png" alt="Pebble User notification" width="600"></a>

Prior to the election day, each voter on the electoral register receives a notification. The application retrieves the election parameters and generates new credentials that will allow them to take part in the election and cast their vote anonymously.

We use Zero Knowledge Set Membership Proofs to accomplish this. Each voter generates a random “serial number”. They create a cryptographic commitment to the serial number and post the commitment to the smart contract. The commitment is signed with a signing key corresponding to a public key in the electoral registry to verify eligibility. Then, each user accumulates all the commitments into a single value for efficiency reasons in later steps.

When voting, users reveal the serial number along with a zero knowledge proof that it corresponds to one of the accumulated commitments, without revealing which one, hence preserving anonymity. It is worth mentioning that the size of the proof is sub-linear with respect to the number of users as we use a single accumulated value instead of the full list of the commitments, thus preserving efficiency. Since the serial number is revealed, duplicate votes can be detected and discarded. Serial numbers that have not yet been revealed cannot be derived from the commitments. It is also computationally infeasible to construct a valid proof for a serial number that has not been previously accumulated.